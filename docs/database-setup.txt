# All-Influencer ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
All-Influencer í”Œë«í¼ì˜ PostgreSQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë° ì„¤ì • ë°©ë²•ì…ë‹ˆë‹¤.

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ
- PostgreSQL 16 (Docker)
- Prisma ORM
- NestJS
- Docker Compose

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

### 1. í•„ìˆ˜ ì‚¬í•­
- Docker & Docker Compose ì„¤ì¹˜
- Node.js 18+ ì„¤ì¹˜
- pnpm ë˜ëŠ” npm ì„¤ì¹˜

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘
```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ì‹¤í–‰
docker-compose up -d postgres

# ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
docker ps | grep postgres
```

### 3. Prisma ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
# apps/api ë””ë ‰í„°ë¦¬ë¡œ ì´ë™
cd apps/api

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (DATABASE_URL)
export DATABASE_URL="postgresql://allinfluencer:allinfluencer@localhost:5432/allinfluencer?schema=public"

# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
npx prisma migrate dev --name init

# Prisma í´ë¼ì´ì–¸íŠ¸ ìƒì„±
npx prisma generate
```

### 4. API ì„œë²„ ì‹¤í–‰
```bash
# apps/api ë””ë ‰í„°ë¦¬ì—ì„œ
npm run build
npm run start

# ë˜ëŠ” ê°œë°œ ëª¨ë“œ
npm run dev
```

## ğŸ”§ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### apps/api/.env íŒŒì¼
```env
# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
DATABASE_URL="postgresql://allinfluencer:allinfluencer@localhost:5432/allinfluencer?schema=public"

# JWT ì„¤ì •
JWT_SECRET="your-super-secret-jwt-key-change-this-in-production-2024"
JWT_ACCESS_EXPIRES_IN="15m"
JWT_REFRESH_EXPIRES_IN="7d"

# ì„œë²„ ì„¤ì •
NODE_ENV="development"
PORT=3001
API_PREFIX="api"

# CORS ì„¤ì •
CORS_ORIGIN="http://localhost:3000"

# ì¿ í‚¤ ì„¤ì •
COOKIE_SECRET="your-cookie-secret-key-2024"
```

## ğŸ³ Docker êµ¬ì„±

### docker-compose.yml ì„œë¹„ìŠ¤
- **postgres**: PostgreSQL 16 ë°ì´í„°ë² ì´ìŠ¤ (í¬íŠ¸: 5432)
- **adminer**: ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë„êµ¬ (í¬íŠ¸: 8080)

### ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ì •ë³´
- **í˜¸ìŠ¤íŠ¸**: localhost
- **í¬íŠ¸**: 5432
- **ë°ì´í„°ë² ì´ìŠ¤**: allinfluencer
- **ì‚¬ìš©ìëª…**: allinfluencer
- **ë¹„ë°€ë²ˆí˜¸**: allinfluencer

## ğŸ” ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬

### Adminer ì›¹ ì¸í„°í˜ì´ìŠ¤
```
URL: http://localhost:8080
ì‹œìŠ¤í…œ: PostgreSQL
ì„œë²„: postgres
ì‚¬ìš©ìëª…: allinfluencer
ë¹„ë°€ë²ˆí˜¸: allinfluencer
ë°ì´í„°ë² ì´ìŠ¤: allinfluencer
```

### Prisma Studio
```bash
# apps/api ë””ë ‰í„°ë¦¬ì—ì„œ
npx prisma studio
```

### ì§ì ‘ PostgreSQL ì ‘ì†
```bash
# Docker ì»¨í…Œì´ë„ˆë¥¼ í†µí•œ ì ‘ì†
docker exec -it allinfluencer-postgres psql -U allinfluencer -d allinfluencer

# ë¡œì»¬ psql í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
psql -h localhost -p 5432 -U allinfluencer -d allinfluencer
```

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### ì£¼ìš” í…Œì´ë¸”
- **User**: ì‚¬ìš©ì ì •ë³´ (OAuth ì§€ì›)
- **UserIdentity**: ì†Œì…œ ë¡œê·¸ì¸ ì—°ê²° ì •ë³´
- **RefreshSession**: JWT ë¦¬í”„ë ˆì‹œ í† í° ê´€ë¦¬
- **InfluencerProfile**: ì¸í”Œë£¨ì–¸ì„œ í”„ë¡œí•„
- **BrandProfile**: ë¸Œëœë“œ í”„ë¡œí•„
- **JobPost**: êµ¬ì¸ê³µê³ 
- **Application**: ì§€ì›ì„œ
- **Campaign**: ìº í˜ì¸
- **Contract**: ê³„ì•½ì„œ

### ê´€ê³„ë„
```
User (1) --> (N) UserIdentity
User (1) --> (N) RefreshSession
User (1) --> (1) InfluencerProfile
User (1) --> (1) BrandProfile
User (1) --> (N) JobPost
User (1) --> (N) Application
```

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ê´€ë¦¬

### ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
```bash
# ìŠ¤í‚¤ë§ˆ ë³€ê²½ í›„
npx prisma migrate dev --name [ë§ˆì´ê·¸ë ˆì´ì…˜_ì´ë¦„]
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸
```bash
npx prisma migrate status
```

### ë§ˆì´ê·¸ë ˆì´ì…˜ ë¦¬ì…‹ (ê°œë°œìš©)
```bash
npx prisma migrate reset
```

## ğŸš¨ ë¬¸ì œ í•´ê²°

### 1. í¬íŠ¸ ì¶©ëŒ ë¬¸ì œ
```bash
# 5432 í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
lsof -i :5432

# Docker ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘
docker-compose restart postgres
```

### 2. ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨
```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
docker exec -it allinfluencer-postgres pg_isready -U allinfluencer

# í™˜ê²½ë³€ìˆ˜ ì¬ì„¤ì •
export DATABASE_URL="postgresql://allinfluencer:allinfluencer@localhost:5432/allinfluencer?schema=public"
```

### 3. Prisma í´ë¼ì´ì–¸íŠ¸ ì˜¤ë¥˜
```bash
# Prisma í´ë¼ì´ì–¸íŠ¸ ì¬ìƒì„±
npx prisma generate

# node_modules ì •ë¦¬ í›„ ì¬ì„¤ì¹˜
rm -rf node_modules package-lock.json
npm install
```

## ğŸ“ˆ ì„±ëŠ¥ ìµœì í™”

### 1. ì—°ê²° í’€ ì„¤ì •
```env
DATABASE_URL="postgresql://allinfluencer:allinfluencer@localhost:5432/allinfluencer?schema=public&connection_limit=20&pool_timeout=20"
```

### 2. ì¸ë±ìŠ¤ ìµœì í™”
- ìì£¼ ì¡°íšŒë˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ì¶”ê°€
- ë³µí•© ì¸ë±ìŠ¤ í™œìš©
- EXPLAIN ANALYZEë¡œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¶„ì„

### 3. ì¿¼ë¦¬ ìµœì í™”
- N+1 ë¬¸ì œ í•´ê²° (include, select í™œìš©)
- ë°°ì¹˜ ì¿¼ë¦¬ ì‚¬ìš©
- í˜ì´ì§€ë„¤ì´ì…˜ êµ¬í˜„

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### 1. ì ‘ì† ê¶Œí•œ
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë°©í™”ë²½ ì„¤ì •
- SSL/TLS ì—°ê²° í™œì„±í™”
- ê°•ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ ì‚¬ìš©

### 2. ë°ì´í„° ë°±ì—…
```bash
# ë°ì´í„° ë°±ì—…
docker exec allinfluencer-postgres pg_dump -U allinfluencer -d allinfluencer > backup_$(date +%Y%m%d_%H%M%S).sql

# ë°ì´í„° ë³µì›
docker exec -i allinfluencer-postgres psql -U allinfluencer -d allinfluencer < backup.sql
```

## ğŸ“ ì§€ì›

ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒ ì •ë³´ë¥¼ í¬í•¨í•˜ì—¬ ë¬¸ì˜í•˜ì„¸ìš”:
- ì˜¤ë¥˜ ë©”ì‹œì§€
- ì‹¤í–‰í•œ ëª…ë ¹ì–´
- í™˜ê²½ ì •ë³´ (OS, Docker ë²„ì „, Node.js ë²„ì „)
- ë¡œê·¸ íŒŒì¼

---
ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2024ë…„ 10ì›” 4ì¼
ë²„ì „: 1.0.0
