# All-Influencer 문제 해결 가이드

## 🚨 일반적인 문제 및 해결방법

이 문서는 All-Influencer 프로젝트 개발 중 자주 발생하는 문제들과 해결 방법을 정리한 것입니다.

## 🛠 패키지 관리자 문제

### 1. pnpm corepack 키 검증 실패
```bash
Error: Cannot find matching keyid: {"signatures":[...],"keys":[...]}
```

**원인**: pnpm corepack의 키 검증 메커니즘 오류

**해결방법**:
```bash
# 방법 1: npm으로 전환 (권장)
rm pnpm-lock.yaml
npm install

# 방법 2: corepack 비활성화
npm config set package-manager npm
corepack disable

# 방법 3: pnpm 직접 설치
npm uninstall -g pnpm
npm install -g pnpm@latest
```

### 2. workspace 설정 문제
```bash
npm error code ENOWORKSPACES
npm error This command does not support workspaces.
```

**해결방법**:
```bash
# 각 앱을 개별적으로 실행
cd apps/api && npm run dev
cd apps/web && npm run dev

# 또는 workspace 설정 확인
cat package.json  # workspaces 설정 확인
```

## 🗄️ 데이터베이스 문제

### 1. 데이터베이스 연결 실패
```bash
Error: P1001: Can't reach database server at `localhost:5432`
```

**해결방법**:
```bash
# Docker 컨테이너 상태 확인
docker ps | grep postgres

# PostgreSQL 재시작
docker-compose restart postgres

# 환경 변수 확인
echo $DATABASE_URL

# 올바른 환경 변수 설정
export DATABASE_URL="postgresql://allinfluencer:allinfluencer@localhost:5432/allinfluencer?schema=public"
```

### 2. Prisma 마이그레이션 실패
```bash
Error: Migration failed to apply cleanly to the shadow database
```

**해결방법**:
```bash
# 마이그레이션 리셋
cd apps/api
npx prisma migrate reset

# 새로운 마이그레이션 생성
npx prisma migrate dev --name init

# Prisma 클라이언트 재생성
npx prisma generate
```

## 🌐 서버 실행 문제

### 1. 포트 충돌
```bash
Error: listen EADDRINUSE: address already in use :::3001
```

**해결방법**:
```bash
# 포트 사용 중인 프로세스 확인
lsof -i :3001
lsof -i :3000
lsof -i :5432

# 프로세스 종료
kill -9 [PID]

# 또는 모든 node 프로세스 종료
pkill -f node
pkill -f nest
```

### 2. 모듈 없음 오류
```bash
Module not found: Can't resolve '@heroicons/react/24/outline'
```

**해결방법**:
```bash
# 누락된 패키지 설치
cd apps/web
npm install @heroicons/react

# 전체 의존성 재설치
rm -rf node_modules package-lock.json
npm install
```

## 🔧 빌드 문제

### 1. TypeScript 컴파일 오류
```bash
Found 2 errors. Watching for file changes.
```

**해결방법**:
```bash
# TypeScript 캐시 정리
rm -rf .next
rm -rf dist
rm -rf node_modules/.cache

# tsconfig.json 확인
cat tsconfig.json

# 의존성 재설치
npm install
```

### 2. Next.js 빌드 실패
```bash
Invalid next.config.js options detected
```

**해결방법**:
```bash
# next.config.js 확인 및 수정
cd apps/web
cat next.config.js

# 환경 변수 설정
touch .env.local
echo "NEXT_PUBLIC_API_URL=http://localhost:3001" > .env.local
```

## 🐳 Docker 문제

### 1. 컨테이너 시작 실패
```bash
Error response from daemon: Conflict. The container name is already in use
```

**해결방법**:
```bash
# 기존 컨테이너 정리
docker stop allinfluencer-postgres allinfluencer-adminer
docker rm allinfluencer-postgres allinfluencer-adminer

# 다시 시작
docker-compose up -d
```

### 2. 볼륨 권한 문제
```bash
Permission denied
```

**해결방법**:
```bash
# 권한 수정 (Linux/macOS)
sudo chown -R $USER:$USER ./postgres_data

# Docker Desktop 권한 확인 (macOS)
# Docker Desktop > Settings > Resources > File sharing
```

## 📝 환경 설정 문제

### 1. 환경 변수 로드 실패
```bash
Environment variables not loaded
```

**해결방법**:
```bash
# .env 파일 위치 확인
ls -la apps/api/.env

# .env 파일 생성
cd apps/api
cat > .env << EOF
DATABASE_URL="postgresql://allinfluencer:allinfluencer@localhost:5432/allinfluencer?schema=public"
JWT_SECRET="your-super-secret-jwt-key"
NODE_ENV="development"
PORT=3001
EOF
```

### 2. CORS 오류
```bash
Access to fetch at 'http://localhost:3001' has been blocked by CORS policy
```

**해결방법**:
```bash
# API 서버 CORS 설정 확인
cd apps/api
grep -r "CORS_ORIGIN" .

# .env 파일에 CORS 설정 추가
echo "CORS_ORIGIN=http://localhost:3000" >> .env
```

## 🔍 디버깅 도구

### 1. 로그 확인 방법
```bash
# API 서버 로그
cd apps/api && npm run dev

# 웹 서버 로그
cd apps/web && npm run dev

# Docker 로그
docker-compose logs -f postgres
docker-compose logs -f adminer
```

### 2. 데이터베이스 상태 확인
```bash
# Prisma Studio 실행
cd apps/api
npx prisma studio

# 직접 데이터베이스 접속
docker exec -it allinfluencer-postgres psql -U allinfluencer -d allinfluencer

# 테이블 목록 확인
\dt

# 사용자 테이블 확인
SELECT * FROM "User" LIMIT 5;
```

## 🚀 성능 문제

### 1. 느린 API 응답
**진단**:
```bash
# API 엔드포인트 응답 시간 측정
curl -w "@curl-format.txt" -o /dev/null -s http://localhost:3001/api/users

# curl-format.txt 내용:
#      time_namelookup:  %{time_namelookup}\n
#         time_connect:  %{time_connect}\n
#      time_appconnect:  %{time_appconnect}\n
#     time_pretransfer:  %{time_pretransfer}\n
#        time_redirect:  %{time_redirect}\n
#   time_starttransfer:  %{time_starttransfer}\n
#                      ----------\n
#           time_total:  %{time_total}\n
```

**해결방법**:
```bash
# 데이터베이스 쿼리 최적화
# Prisma 쿼리에 인덱스 추가
# 페이지네이션 구현
```

### 2. 메모리 사용량 과다
**진단**:
```bash
# Node.js 프로세스 메모리 사용량
ps aux | grep node

# Docker 컨테이너 리소스 사용량
docker stats
```

**해결방법**:
```bash
# Node.js 메모리 제한 설정
export NODE_OPTIONS="--max-old-space-size=4096"

# Docker 컨테이너 메모리 제한
# docker-compose.yml에 추가:
# deploy:
#   resources:
#     limits:
#       memory: 1G
```

## 🔒 보안 문제

### 1. JWT 토큰 문제
```bash
JsonWebTokenError: invalid token
```

**해결방법**:
```bash
# JWT 시크릿 확인
grep JWT_SECRET apps/api/.env

# 강력한 시크릿으로 변경
echo "JWT_SECRET=$(openssl rand -base64 32)" >> apps/api/.env
```

### 2. 쿠키 설정 문제
```bash
Cookies not being set
```

**해결방법**:
```bash
# 쿠키 설정 확인
# secure: false (개발 환경)
# httpOnly: true
# sameSite: 'lax'
```

## 📱 프론트엔드 문제

### 1. 컴포넌트 렌더링 오류
```bash
Hydration failed because the initial UI does not match
```

**해결방법**:
```bash
# .next 캐시 정리
cd apps/web
rm -rf .next

# 의존성 재설치
npm install

# 개발 서버 재시작
npm run dev
```

### 2. API 호출 실패
```bash
TypeError: Failed to fetch
```

**해결방법**:
```bash
# API URL 확인
echo $NEXT_PUBLIC_API_URL

# 네트워크 탭에서 요청 확인
# 브라우저 개발者 도구 > Network 탭
```

## 📞 추가 지원

### 도움이 필요한 경우
1. **GitHub Issues**: 버그 리포트 및 기능 요청
2. **개발 문서**: `docs/` 폴더의 다른 문서들 참고
3. **로그 분석**: 항상 전체 오류 메시지와 스택 트레이스 포함

### 문제 신고 시 포함할 정보
- 운영 체제 및 버전
- Node.js 버전 (`node --version`)
- npm/pnpm 버전
- Docker 버전 (Docker 사용 시)
- 전체 오류 메시지
- 재현 단계

---
**마지막 업데이트**: 2024년 10월 4일  
**버전**: 1.0.0
